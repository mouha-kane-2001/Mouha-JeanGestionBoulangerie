<div class="container-fluid">
  <!-- Header avec bouton de retour -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0"><i class="fas fa-file-invoice me-2"></i>Détails de la Facture</h2>
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left me-2"></i>Retour aux factures
    </button>
  </div>

  <!-- Container principal -->
  <div class="invoice-container">
    <!-- En-tête de la facture -->
    <div class="invoice-header">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h3 class="mb-0">Facture #{{selectedFacture?.numero_facture}}</h3>
          <p class="mb-0 mt-2">Date d'émission: {{selectedFacture?.date_emission | date:'dd/MM/yyyy'}}</p>
        </div>
        <div class="col-md-6 text-md-end">
          <span class="invoice-status" [ngClass]="{
            'bg-success': selectedFacture?.statut === 'payée',
            'bg-warning': selectedFacture?.statut === 'en_attente',
            'bg-danger': selectedFacture?.statut === 'annulée'
          }">
            {{getStatusText(selectedFacture?.statut)}}
          </span>
        </div>
      </div>
    </div>

    <!-- Corps de la facture -->
    <div class="invoice-body">
      <!-- Informations client -->
      <div class="row mb-5">
        <div class="col-md-6">
          <div class="client-info">
            <h5 class="mb-3">Informations Client</h5>
<p class="mb-1"><strong>Nom:</strong> {{selectedFacture?.user?.prenom}} {{selectedFacture?.user?.nom}}</p>
<p><strong>Email:</strong> {{selectedFacture?.user?.email}}</p>

<p><strong>Téléphone:</strong> {{selectedFacture?.user?.telephone || 'Non renseigné'}}</p>
<p><strong>Adresse:</strong> {{selectedFacture?.user?.adresse_livraison}}</p>
          </div>
        </div>
        <div class="col-md-6">
          <div class="client-info">
            <h5 class="mb-3">Informations Facturation</h5>
            <p class="mb-1"><strong>Montant Total:</strong> {{selectedFacture?.montant_total | currency:'EUR'}}</p>
            <p class="mb-1"><strong>Méthode de Paiement:</strong> {{selectedFacture?.methode_paiement || 'Non spécifiée'}}</p>
            <p class="mb-1"><strong>Date d'échéance:</strong> {{selectedFacture?.date_echeance | date:'dd/MM/yyyy'}}</p>
            <p class="mb-0"><strong>Référence:</strong> {{selectedFacture?.reference_paiement || 'Non disponible'}}</p>
          </div>
        </div>
      </div>

      <!-- Détails des articles -->
      <h5 class="mb-3">Articles de la facture</h5>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Produit/Pack</th>
              <th class="text-center">Quantité</th>
              <th class="text-end">Prix Unitaire</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let detail of detailsFacture">
      <td>{{detail.produit?.nom || detail.pack?.nom}}</td>
      <td>{{detail.quantite}}</td>
      <td>{{detail.prix_unitaire}}</td>
      <td>{{detail.total_ligne}}</td>
    </tr>

          </tbody>
        </table>
      </div>

      <!-- Totaux -->
      <div class="row justify-content-end mt-4">
        <div class="col-md-5">
          <div class="total-section">
            <div class="d-flex justify-content-between mb-2">
               <span>{{selectedFacture?.montant_ht | currency:'EUR'}}</span>
            </div>

            <hr>
            <div class="d-flex justify-content-between mb-0">
              <strong>Total:</strong>
              <strong>{{selectedFacture?.montant_total | currency:'EUR'}}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pied de page -->
    <div class="invoice-footer">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-0"><strong>Conditions de paiement:</strong> Paiement dans les 30 jours suivant la date de facturation</p>
        </div>
        <div class="col-md-6 text-md-end">

          <button class="btn btn-primary"  (click)="telechargerFacture(selectedFacture.id)"

>
            <i class="fas fa-download me-2"></i>Télécharger la facture
          </button>


        </div>
      </div>
    </div>
  </div>
</div>
