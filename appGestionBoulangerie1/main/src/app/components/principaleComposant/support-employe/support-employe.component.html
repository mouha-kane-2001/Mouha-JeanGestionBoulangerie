<div class="support-container">
  <h2>Support Employé</h2>

  <div class="row">
    <!-- Liste des conversations ouvertes -->
    <div class="col-4">
      <h4>Conversations ouvertes</h4>
      <ul>
       <li *ngFor="let conv of conversations"
    (click)="selectConversation(conv.id)"
    [class.selected]="conv.id === selectedConversationId">
  {{ conv.sujet || 'Sans sujet' }} - {{ conv.user.prenom }}  {{ conv.user.nom }} - {{ conv.statut }}
</li>
      </ul>
    </div>

    <!-- Messages -->
    <div class="col-8" *ngIf="selectedConversationId">
      <h4>Messages</h4>
      <div class="messages-box">
       <div *ngFor="let msg of messages" [ngClass]="msg.type">
  <strong *ngIf="msg.type === 'client'">{{ msg.user?.prenom }} {{ msg.user?.nom }}:</strong>
  <strong *ngIf="msg.type === 'employe'">Vous:</strong>
  <span>{{ msg.contenu }}</span>
</div>
      </div>

      <!-- Nouveau message -->
      <div class="nouveau-message mt-2">
        <input type="text" [(ngModel)]="nouveauMessage" placeholder="Écrire un message..." />
        <button (click)="envoyerMessage()">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<style>
.support-container {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f8f9fa;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h2 {
  color: #2c3e50;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #e9ecef;
}

h4 {
  color: #34495e;
  margin-bottom: 15px;
}

.row {
  background-color: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
}

.col-4 {
  padding: 15px;
  border-right: 1px solid #e9ecef;
  background-color: #f8f9fa;
  min-height: 500px;
}

.col-8 {
  padding: 15px;
  min-height: 500px;
  display: flex;
  flex-direction: column;
}

ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

li {
  padding: 12px 15px;
  border-bottom: 1px solid #e9ecef;
  cursor: pointer;
  transition: background-color 0.2s;
}

li:hover {
  background-color: #e9ecef;
}

li.selected {
  background-color: #dee2e6;
  font-weight: bold;
}

.messages-box {
  flex-grow: 1;
  overflow-y: auto;
  padding: 10px;
  background-color: #f8f9fa;
  border-radius: 6px;
  margin-bottom: 15px;
  max-height: 400px;
}

.client, .employe {
  margin-bottom: 15px;
  padding: 10px 15px;
  border-radius: 8px;
  max-width: 80%;
}

.client {
  background-color: #e3f2fd;
  margin-right: auto;
}

.employe {
  background-color: #d1ecf1;
  margin-left: auto;
}

.nouveau-message {
  display: flex;
  gap: 10px;
}

input {
  flex-grow: 1;
  padding: 10px 15px;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 14px;
}

button {
  padding: 10px 20px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button:hover {
  background-color: #2980b9;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .row {
    flex-direction: column;
  }

  .col-4, .col-8 {
    width: 100%;
    min-height: auto;
  }

  .col-4 {
    border-right: none;
    border-bottom: 1px solid #e9ecef;
  }
}
</style>

<script>
// Données simulées pour démonstration
const conversationsData = [
  {
    id: 1,
    sujet: "Problème de connexion",
    user: { prenom: "Jean", nom: "Dupont" },
    statut: "En cours"
  },
  {
    id: 2,
    sujet: "Question sur la facturation",
    user: { prenom: "Marie", nom: "Martin" },
    statut: "Nouveau"
  },
  {
    id: 3,
    sujet: "",
    user: { prenom: "Pierre", nom: "Durand" },
    statut: "En attente"
  }
];

const messagesData = {
  1: [
    { type: "client", contenu: "Bonjour, je n'arrive pas à me connecter à mon compte." },
    { type: "employe", contenu: "Bonjour, avez-vous vérifié votre mot de passe ?" },
    { type: "client", contenu: "Oui, j'ai essayé de réinitialiser mais je ne reçois pas l'email." }
  ],
  2: [
    { type: "client", contenu: "Bonjour, je ne comprends pas les frais sur ma dernière facture." }
  ],
  3: [
    { type: "client", contenu: "Bonjour, j'ai besoin d'aide avec..." }
  ]
};

// Simulation des fonctionnalités Angular
document.addEventListener('DOMContentLoaded', function() {
  // Éléments du DOM
  const conversationList = document.querySelector('.col-4 ul');
  const messagesContainer = document.querySelector('.messages-box');
  const messageInput = document.querySelector('input');
  const sendButton = document.querySelector('button');
  const messageSection = document.querySelector('.col-8');

  // Variables d'état
  let selectedConversationId = null;
  let nouveauMessage = '';

  // Remplir la liste des conversations
  function loadConversations() {
    conversationList.innerHTML = '';
    conversationsData.forEach(conv => {
      const li = document.createElement('li');
      li.textContent = `${conv.sujet || 'Sans sujet'} - ${conv.user.prenom} ${conv.user.nom} - ${conv.statut}`;
      li.addEventListener('click', () => selectConversation(conv.id));
      if (conv.id === selectedConversationId) {
        li.classList.add('selected');
      }
      conversationList.appendChild(li);
    });
  }

  // Sélectionner une conversation
  function selectConversation(id) {
    selectedConversationId = id;
    loadConversations();
    loadMessages(id);
    messageSection.style.display = 'block';
  }

  // Charger les messages d'une conversation
  function loadMessages(conversationId) {
    messagesContainer.innerHTML = '';
    const messages = messagesData[conversationId] || [];

    messages.forEach(msg => {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add(msg.type);

      const strong = document.createElement('strong');
      strong.textContent = msg.type === 'client' ? 'Client:' : 'Vous:';

      const span = document.createElement('span');
      span.textContent = ` ${msg.contenu}`;

      msgDiv.appendChild(strong);
      msgDiv.appendChild(span);
      messagesContainer.appendChild(msgDiv);
    });

    // Faire défiler vers le bas pour voir les derniers messages
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  // Envoyer un message
  function envoyerMessage() {
    if (!selectedConversationId || !nouveauMessage.trim()) return;

    if (!messagesData[selectedConversationId]) {
      messagesData[selectedConversationId] = [];
    }

    // Ajouter le nouveau message
    messagesData[selectedConversationId].push({
      type: 'employe',
      contenu: nouveauMessage
    });

    // Recharger les messages
    loadMessages(selectedConversationId);

    // Réinitialiser le champ de saisie
    messageInput.value = '';
    nouveauMessage = '';
  }

  // Événements
  messageInput.addEventListener('input', function() {
    nouveauMessage = this.value;
  });

  sendButton.addEventListener('click', envoyerMessage);

  messageInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      envoyerMessage();
    }
  });

  // Initialiser l'interface
  loadConversations();
  messageSection.style.display = 'none';
});
</script>
